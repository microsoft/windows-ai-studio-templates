{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "description": "The version of the yaml file schema.",
      "const": "v0.1"
    },
    "workingDir": {
      "type": "string",
      "description": "The working directory including AI Toolkit generated artifacts."
    },
    "environmentFolder": {
      "type": "string",
      "description": "The folder of .env files used for AI Toolkit variables."
    },
    "projectId": {
      "type": "string",
      "description": "The projectId used for telemetry."
    },
    "dataset": {
      "$ref": "#/definitions/datasetObject"
    },
    "evaluation": {
      "$ref": "#/definitions/evaluationObject"
    },
    "finetuning": {
      "$ref": "#/definitions/finetuningObject"
    },
    "inference": {
      "$ref": "#/definitions/inferenceObject"
    }
  },
  "required": [
    "version",
    "workingDir"
  ],
  "definitions": {
    "datasetObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "The Dataset feature definition.",
      "properties": {
        "content": {
          "type": "array",
          "additionalProperties": false,
          "description": "The list of dataset file patterns.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "content"
      ]
    },
    "evaluationObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "The Evaluation feature definition.",
      "properties": {
        "results": {
          "type": "array",
          "additionalProperties": false,
          "description": "The list of evaluation result file patterns.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "results"
      ]
    },
    "finetuningObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "The Fine-Tuning feature definition.",
      "properties": {
        "runOn": {
          "type": "string",
          "description": "Run finetuning on Azure Container Apps.",
          "const": "containerapp"
        },
        "provision": {
          "$ref": "#/definitions/provisionStepObject"
        },
        "run": {
          "type": "object",
          "additionalProperties": false,
          "description": "The run step definition.",
          "properties": {
            "job": {
              "type": "string",
              "description": "The Azure Container Job resource ID."
            },
            "fileShare": {
              "type": "string",
              "description": "The Azure File Share resource ID."
            },
            "command": {
              "type": "string",
              "description": "The finetuning command."
            },
            "artifacts": {
              "type": "array",
              "additionalProperties": false,
              "description": "The finetuning artifacts to be synced to file share.",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "job"
          ]
        }
      },
      "required": [
        "runOn",
        "provision",
        "run"
      ]
    },
    "inferenceObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "The Inference feature definition.",
      "properties": {
        "runOn": {
          "type": "string",
          "description": "Inference on Azure Container Apps.",
          "const": "containerapp"
        },
        "provision": {
          "$ref": "#/definitions/provisionStepObject"
        },
        "deploy": {
          "type": "object",
          "additionalProperties": false,
          "description": "The deploy step definition.",
          "properties": {
            "app": {
              "type": "string",
              "description": "The Azure Container App resource ID."
            },
            "fileShare": {
              "type": "string",
              "description": "The Azure File Share resource ID."
            },
            "artifacts": {
              "type": "array",
              "additionalProperties": false,
              "description": "The inference artifacts to be synced to file share.",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "app"
          ]
        }
      },
      "required": [
        "runOn",
        "provision",
        "deploy"
      ]
    },
    "provisionStepObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "The provision step definition.",
      "properties": {
        "subscriptionId": {
          "type": "string",
          "description": "The Azure subscription ID."
        },
        "resourceGroupName": {
          "type": "string",
          "description": "The Azure resource group name."
        },
        "templates": {
          "type": "array",
          "description": "The list of Bicep templates",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "path": {
                "type": "string",
                "description": "Relative path to Bicep template."
              },
              "parameters": {
                "type": "string",
                "description": "Relative path to parameters file."
              }
            },
            "required": [
              "path"
            ]
          }
        }
      },
      "required": [
        "subscriptionId",
        "resourceGroupName",
        "templates"
      ]
    }
  }
}